<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FDR • pcadapt</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pcadapt</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/pcadapt.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BioShock38/pcadapt">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>FDR</h1>
            
          </div>

    
    
<div class="contents">
<div id="description" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#description" class="anchor"> </a></body></html>Description</h2>
<p>This vignette describes a way to compare different methods, based on the rankings provided by the statistics they return. One way to do this is to draw the power as a function of the false discovery rate, which requires to compute the power and the false discovery rate incrementally for each method. Here is a quick example of how to achieve this type of comparison.</p>
</div>
<div id="get-two-sets-of-statistics" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#get-two-sets-of-statistics" class="anchor"> </a></body></html>Get two sets of statistics</h2>
<p>Let’s compare the Mahalanobis distance and the communality statistics by running <code>pcadapt</code> on <code>geno3pops</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pcadapt)
file &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read.pcadapt.html">read.pcadapt</a></span>(<span class="st">"geno3pops"</span>, <span class="dt">type =</span> <span class="st">"example"</span>)
geno &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">read.table</span>(file))
gt &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">150</span>
x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pcadapt.html">pcadapt</a></span>(geno, <span class="dt">K =</span> <span class="dv">2</span>, <span class="dt">method =</span> <span class="st">"mahalanobis"</span>)</code></pre></div>
<pre><code>## Number of SNPs: 1500
## Number of individuals: 150</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pcadapt.html">pcadapt</a></span>(geno, <span class="dt">K =</span> <span class="dv">2</span>, <span class="dt">method =</span> <span class="st">"communality"</span>)</code></pre></div>
<pre><code>## Number of SNPs: 1500
## Number of individuals: 150</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rank.stat<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">sort</span>(x$pvalues, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>, <span class="dt">index.return =</span> <span class="ot">TRUE</span>)$ix <span class="co">#any set of p-values</span>
rank.stat<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">sort</span>(y$pvalues, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>, <span class="dt">index.return =</span> <span class="ot">TRUE</span>)$ix</code></pre></div>
</div>
<div id="fdr-and-power" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#fdr-and-power" class="anchor"> </a></body></html>FDR and power</h2>
<p>The functions <code>compute.fdr</code> and <code>compute.power</code> defined below respectively compute the values of FDR and power for a list of candidates (<code>list</code>) and a given list of true positives (<code>ground.truth</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compute.fdr =<span class="st"> </span>function(list, ground.truth){
  if (<span class="kw">length</span>(list) ==<span class="st"> </span><span class="dv">0</span>){
    x &lt;-<span class="st"> </span><span class="dv">0</span>
  } else {
    x &lt;-<span class="st"> </span><span class="kw">sum</span>(!(list %in%<span class="st"> </span>ground.truth)) /<span class="st"> </span><span class="kw">length</span>(list)
  }
  <span class="kw">return</span>(x)
}

compute.power =<span class="st"> </span>function(list, ground.truth){
  if (<span class="kw">length</span>(ground.truth) ==<span class="st"> </span><span class="dv">0</span>){
    <span class="kw">warning</span>(<span class="st">"The list of true positives is empty."</span>)
  } else {
    x &lt;-<span class="st"> </span><span class="kw">sum</span>(list %in%<span class="st"> </span>ground.truth) /<span class="st"> </span><span class="kw">length</span>(ground.truth)
  }
  <span class="kw">return</span>(x)
}</code></pre></div>
<p>Now if you want to plot the power as a function of the false discovery rate, you need to compute both power and FDR for any list of candidates which length should ideally vary from one to the total number of markers. What you want to do is ranking your markers according to their p-value, then compute both FDR and power for the marker with the lowest p-value, store both values in a data frame, then add the second marker with the lowest p-value, compute both FDR and power, store them in the data frame, and so on. The function below takes on these computations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">create.fdr.pow =<span class="st"> </span>function(list, ground.truth, <span class="dt">lmax =</span> <span class="kw">length</span>(list), <span class="dt">smooth =</span> <span class="ot">TRUE</span>){
  fdr &lt;-<span class="st"> </span><span class="dv">0</span>
  pow &lt;-<span class="st"> </span><span class="dv">0</span>
  s &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, lmax, <span class="dt">by =</span> <span class="dv">1</span>)
  for (k in s){
    l &lt;-<span class="st"> </span>list[<span class="dv">1</span>:k]
    fdr &lt;-<span class="st"> </span><span class="kw">c</span>(fdr, <span class="kw">compute.fdr</span>(l, ground.truth))
    pow &lt;-<span class="st"> </span><span class="kw">c</span>(pow, <span class="kw">compute.power</span>(l, ground.truth))
  }
  res &lt;-<span class="st"> </span><span class="ot">NULL</span>
  idx &lt;-<span class="st"> </span><span class="kw">sort</span>(fdr, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>, <span class="dt">index.return =</span> <span class="ot">TRUE</span>)$ix
  fdr &lt;-<span class="st"> </span>fdr[idx]
  pow &lt;-<span class="st"> </span>pow[idx]
  if (smooth ==<span class="st"> </span><span class="ot">FALSE</span>){
    res$fdr &lt;-<span class="st"> </span>fdr
    res$pow &lt;-<span class="st"> </span>pow
  } else if (smooth ==<span class="st"> </span><span class="ot">TRUE</span>){
    pow.old &lt;-<span class="st"> </span><span class="dv">0</span>
    fdr.old &lt;-<span class="st"> </span><span class="dv">0</span>
    aux.fdr &lt;-<span class="st"> </span><span class="dv">0</span>
    aux.pow &lt;-<span class="st"> </span><span class="dv">0</span>
    for (val in <span class="dv">1</span>:<span class="kw">length</span>(fdr)){
      if (pow[val] &gt;=<span class="st"> </span>pow.old){
        aux.fdr &lt;-<span class="st"> </span><span class="kw">c</span>(aux.fdr, fdr[val])
        aux.pow &lt;-<span class="st"> </span><span class="kw">c</span>(aux.pow, pow[val])
        pow.old &lt;-<span class="st"> </span>pow[val]
      }
    }
    res$fdr &lt;-<span class="st"> </span>aux.fdr
    res$pow &lt;-<span class="st"> </span>aux.pow
  }
  <span class="kw">return</span>(res)
}</code></pre></div>
</div>
<div id="build-the-data-frame" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#build-the-data-frame" class="anchor"> </a></body></html>Build the data frame</h2>
<p>Now all we need is a function to generate a data frame so we can visualize the result with <code>ggplot2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">create.df =<span class="st"> </span>function(res, soft.name){
  ncol &lt;-<span class="st"> </span><span class="kw">length</span>(res$fdr)
  df &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw">c</span>(ncol, <span class="dv">3</span>))
  df[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(soft.name, ncol)
  df[, <span class="dv">2</span>] &lt;-<span class="st"> </span>res$fdr
  df[, <span class="dv">3</span>] &lt;-<span class="st"> </span>res$pow
  <span class="kw">return</span>(<span class="kw">as.data.frame</span>(df))
}

<span class="co"># Generate fdr and power values for each method:</span>
res<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">create.fdr.pow</span>(rank.stat<span class="fl">.1</span>, gt, <span class="dt">smooth =</span> <span class="ot">TRUE</span>)
df<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">create.df</span>(res<span class="fl">.1</span>, <span class="st">"Mahalanobis"</span>)
res<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">create.fdr.pow</span>(rank.stat<span class="fl">.2</span>, gt, <span class="dt">smooth =</span> <span class="ot">TRUE</span>)
df<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">create.df</span>(res<span class="fl">.2</span>, <span class="st">"Communality"</span>)

df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df<span class="fl">.1</span>, df<span class="fl">.2</span>)
<span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Software"</span>, <span class="st">"FDR"</span>, <span class="st">"Power"</span>)
df[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.character</span>(df[, <span class="dv">1</span>])
df[, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(df[, <span class="dv">2</span>]))
df[, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(df[, <span class="dv">3</span>]))</code></pre></div>
</div>
<div id="display-the-curves" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#display-the-curves" class="anchor"> </a></body></html>Display the curves</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(ggplot2)
p0 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> FDR, <span class="dt">y =</span> Power)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Software), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) +<span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) +
<span class="st">  </span><span class="kw">theme_bw</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>),
        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>, <span class="dt">face =</span> <span class="st">"bold"</span>),
        <span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>, <span class="dt">face =</span> <span class="st">"bold"</span>),
        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>),
        <span class="dt">legend.key.height =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">"line"</span>),
        <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">"line"</span>)
  )
<span class="kw">print</span>(p0)</code></pre></div>
<p><img src="tuto_fdr_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#description">Description</a></li>
      <li><a href="#get-two-sets-of-statistics">Get two sets of statistics</a></li>
      <li><a href="#fdr-and-power">FDR and power</a></li>
      <li><a href="#build-the-data-frame">Build the data frame</a></li>
      <li><a href="#display-the-curves">Display the curves</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Keurcien Luu, Michael Blum.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
